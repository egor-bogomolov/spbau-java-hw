# spbau-java-hw

## MyGit
Приложение реализует простую систему контроля версий и консольную оболочку над ней.

### Сборка jar-файла
Чтобы собрать отдельный jar-файл, в папке MyGit вызовите `gradlew createJar`. Собранный jar-файл будет в папке MyGit/build/libs.

### Работа с приложением
Работа осуществляется через консоль. Команды передаются как параметры при вызове. Чтобы получить список всех команд, запустите приложение с параметром `help`.

### Внутреннее устройство

#### Проект
Проект разделен на библиотеку, описывающую систему контроля версий, и main, представляющий из себя консольное приложение, оборачивающее работу с этой библиотекой.

Библиотека состоит из набора классов, описывающих разные сущности системы контроля версий, и вспомогательных классов для них. Основной из сущностей является RepositoryManager, он представляет из себя обертку над репозиторием. Через него происходят все действия с репозиторием. Чтобы создать репозиторий и получить копию менеджера, приложение вызывает `initRepository`,  чтобы получить копию по уже имеющемуся репозиторию, вызывается `getRepositoryManager`.

#### Обработка комманд
Внутри Main'а происходит парсинг аргументов комманд и вызов соответствующих им методов у RepositoryManager. Во всех командах путь к файлам принимается абсолютный. Что при этом происходит:

* **init** - создается служебная папка *.mygit* в текущей директории, ветка *master* и делается первоначальный коммит.
* **remove_repository** - служебная папка *.mygit* вместе со всем ее содержимым удаляется.
* **add** - добавляет файл в систему контроля версий. При этом его содержимое сохраняется в *./mygit/objects* в *Blob*'е по хешу, информация об этом записывается в *./mygit/index* в формате <путь, хеш *Blob*'a>.
* **commit** - создается новый коммит - *Commit* - с текущим временем, именем пользователя в системе в качестве автора и переданным описанием. В него входят все файлы, информация о которых есть в индексе, в тех версиях, которые там записаны, которые в текущем коммите отсутствовали/имели другое содержимое. Строится новое *Tree*, описывающее этот коммит, все записывается по хешам в *./mygit/objects*
* **branch** - создается новая ветка - *Branch* - с переданным названием. Нельзя создать ветку с уже встретившимся названием. Головным коммитом этой ветки становится текущий головной коммит репозитория. *Branch* сохраняется по имени ветки в *./mygit/branches*
* **remove_branch** - ветка с переданным названием удаляется, удаляется соответствующий ей файл в *./mygit/branches*
* **checkout** - принимает название коммита или ветки. Если это ветка, то берется головной коммит этой ветки, его дерево обходится, все нужные файлы создаются/перезаписываются, используя соответствующие *Blob*'ы из *./mygit/objects*. Если же это коммит, то создается новая ветка с названием этого коммита, в ней он выставляется головным и происходит то же самое.
* **merge** - принимает название ветки и сливает ее с текущей. При этом сперва обходится дерево второй ветки, потом уже текущей. Если файл встречается в обеих ветках, то приоритет отдается его версии из текущей. Строится дерево полученное таким объединением деревьев веток, делается новый коммит, описывающий произошедее. Он становится головным.
* **log** - выводит название текущей ветки, проходит рекурсивно по предкам текущего головного коммита, выводит информацию о них в консоль в хронологическом порядке.
